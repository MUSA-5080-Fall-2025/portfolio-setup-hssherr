View(acs_vars_2022)
# Pro tip: You can also search specific table groups
# B01 = Age and Sex
# B19 = Income
# B25 = Housing
table_b19 <- acs_vars_2022 %>%
filter(str_detect(name, "^B19"))  # ^ means "starts with"
print("All B19 (Income) table variables:")
head(table_b19, 10)
# Test the variables you found
test_vars <- c(
total_pop = "B01003_001",      # Total population
median_income = "B19013_001",  # Median household income
median_age = "B01002_001"      # Median age
)
# Get data for just one state to test
test_data <- get_acs(
geography = "state",
variables = test_vars,
state = "PA",
year = 2022
)
# Check that you got what you expected
test_data
# Common patterns to remember:
common_variables <- tribble(
~concept, ~typical_code, ~description,
"Total Population", "B01003_001", "Total population",
"Median Age", "B01002_001", "Median age of population",
"Median HH Income", "B19013_001", "Median household income",
"White Population", "B03002_003", "White alone population",
"Black Population", "B03002_004", "Black/African American alone",
"Hispanic Population", "B03002_012", "Hispanic or Latino population",
"Bachelor's Degree", "B15003_022", "Bachelor's degree or higher",
"Median Rent", "B25058_001", "Median contract rent",
"Median Home Value", "B25077_001", "Median value owner-occupied"
)
print("Common Census Variables:")
common_variables
# Get county-level data for your state
county_data <- get_acs(
geography = "county",
variables = c(
total_pop = "B01003_001",       # Total population
median_income = "B19013_001",   # Median household income
median_age = "B01002_001"       # Median age
),
state = state_choice,
year = 2022,
output = "wide"
)
# Clean county names
county_data <- county_data %>%
mutate(county_name = str_remove(NAME, paste0(", ", state_choice)))
# Basic inspection
glimpse(county_data)
# Create histogram of median income
ggplot(county_data) +
aes(x = median_incomeE) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Median Household Income",
x = "Median Household Income ($)",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous(labels = dollar)
# Box plot to see outliers clearly
ggplot(county_data) +
aes(y = median_incomeE) +
geom_boxplot(fill = "lightblue", width = 0.5) +
labs(
title = "Median Income Distribution with Outliers",
y = "Median Household Income ($)"
) +
theme_minimal() +
scale_y_continuous(labels = dollar)
# Identify the outlier counties
income_outliers <- county_data %>%
mutate(
Q1 = quantile(median_incomeE, 0.25, na.rm = TRUE),
Q3 = quantile(median_incomeE, 0.75, na.rm = TRUE),
IQR = Q3 - Q1,
outlier = median_incomeE < (Q1 - 1.5 * IQR) | median_incomeE > (Q3 + 1.5 * IQR)
) %>%
filter(outlier) %>%
select(county_name, median_incomeE)
print("Outlier counties:")
income_outliers
View(population_vars)
View(table_b19)
View(test_data)
View(acs_vars_2022)
View(county_data)
# histogram of total population
ggplot(county_data) +
aes(x = total_popE) +
geom_histogram(bins = 15, fill = "#73956F", alpha = 0.7) +
labs(
title = "Distribution of Total Population",
x = "Population",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous(labels = dollar)
# histogram of total population
ggplot(county_data) +
aes(x = total_popE) +
geom_histogram(bins = 15, fill = "#73956F", alpha = 0.7) +
labs(
title = "Distribution of Total Population",
x = "Population",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous()
# histogram of total population
ggplot(county_data) +
aes(x = total_popE) +
geom_histogram(bins = 50, fill = "#73956F", alpha = 0.7) +
labs(
title = "Distribution of Total Population",
x = "Population",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous()
# histogram of total population
ggplot(county_data) +
aes(x = total_popE) +
geom_histogram(bins = 50, fill = "#73956F", alpha = 0.9) +
labs(
title = "Distribution of Total Population",
x = "Population",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous()
# histogram of total population
ggplot(county_data) +
aes(x = total_popE) +
geom_histogram(bins = 50, fill = "#73956F", colour = "grey25", alpha = 0.9) +
labs(
title = "Distribution of Total Population",
x = "Population",
y = "Number of Counties"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", width = 0.5) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
# Identify the outlier counties
pop_outliers <- county_data %>%
mutate(
Q1 = quantile(total_popE, 0.25, na.rm = TRUE),
Q3 = quantile(total_popE, 0.75, na.rm = TRUE),
IQR = Q3 - Q1,
outlier = total_popE < (Q1 - 1.5 * IQR) | total_popE > (Q3 + 1.5 * IQR)
) %>%
filter(outlier) %>%
select(county_name, total_popE)
print("Outlier counties:")
pop_outliers
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", width = 0.5) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F") +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
print("Outlier counties:")
View(pop_outliers)
print("Outlier counties:")
pop_outliers
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F") +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.5) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 1) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 1) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.125, 0.125) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 1) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.25, 0.25) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.5) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.25, 0.25) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.2) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.25, 0.25) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.2) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.125) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.25) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.25) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.125, 0.125)
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.25) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.125, 0.125) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.2) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.125, 0.125) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.2) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.1, 0.1) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.1) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.1, 0.1) +
theme_minimal() +
scale_x_continuous()
ggplot(county_data) +
aes(x = median_incomeE) +
geom_boxplot(fill = "#73956F", , width = 0.1) +
labs(
title = "Total Population Distribution with Outliers",
x = "Population"
) +
ylim(-0.25, 0.25) +
theme_minimal() +
scale_x_continuous()
# Enhanced scatter plot with trend line
ggplot(county_data) +
aes(x = total_popE, y = median_incomeE) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = TRUE, color = "red") +
labs(
title = "Population vs Median Income in Pennsylvania Counties",
subtitle = "2018-2022 ACS 5-Year Estimates",
x = "Total Population",
y = "Median Household Income ($)",
caption = "Source: U.S. Census Bureau"
) +
theme_minimal() +
scale_x_continuous(labels = comma) +
scale_y_continuous(labels = dollar)
# Enhanced scatter plot with trend line
ggplot(county_data) +
aes(x = total_popE, y = median_incomeE) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = TRUE, color = "red") +
labs(
title = "Population vs Median Income in Pennsylvania Counties",
subtitle = "2018-2022 ACS 5-Year Estimates",
x = "Total Population",
y = "Median Household Income ($)",
caption = "Source: U.S. Census Bureau"
) +
theme_minimal() +
scale_x_continuous(labels = comma) +
scale_y_continuous(labels = dollar)
# Calculate correlation
correlation <- cor(county_data$total_popE, county_data$median_incomeE, use = "complete.obs")
print(paste("Correlation coefficient:", round(correlation, 3)))
# Log-transformed scatter plot
ggplot(county_data) +
aes(x = log(total_popE), y = median_incomeE) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = TRUE) +
labs(
title = "Log(Population) vs Median Income",
x = "Log(Total Population)",
y = "Median Household Income ($)"
) +
theme_minimal() +
scale_y_continuous(labels = dollar)
ggplot(data = county_data) +
aes(x = median_ageE, y = median_incomeE) +
geom_point(fill = "red3", alpha = 0.5) +
geom_smooth(method = "loess", se = T) +
labs(title = "Median Age vs. Median Income of Pennsylvania Counties",
x = "Median Income ($)",
y = "Median Age (yrs)") +
theme_dark() +
scale_x_continuous(labels = dollar)
ggplot(data = county_data) +
aes(x = median_ageE, y = median_incomeE) +
geom_point(fill = "red", alpha = 0.5) +
geom_smooth(method = "loess", se = T) +
labs(title = "Median Age vs. Median Income of Pennsylvania Counties",
x = "Median Income ($)",
y = "Median Age (yrs)") +
theme_dark() +
scale_x_continuous(labels = dollar)
ggplot(data = county_data) +
aes(x = median_ageE, y = median_incomeE) +
geom_point(fill = "red", alpha = 0.5) +
geom_smooth(method = "loess", se = T, color = "grey95") +
labs(title = "Median Age vs. Median Income of Pennsylvania Counties",
x = "Median Income ($)",
y = "Median Age (yrs)") +
theme_dark() +
scale_x_continuous(labels = dollar)
ggplot(data = county_data) +
aes(x = median_ageE, y = median_incomeE) +
geom_point(fill = "red", alpha = 0.5) +
geom_smooth(method = "loess", se = T, color = "grey95") +
labs(title = "Median Age vs. Median Income of Pennsylvania Counties",
x = "Median Income (k$)",
y = "Median Age (yrs)") +
theme_dark() +
scale_x_continuous(labels = dollar)
# Calculate MOE percentages
county_reliability <- county_data %>%
mutate(
income_moe_pct = (median_incomeM / median_incomeE) * 100,
pop_category = case_when(
total_popE < 50000 ~ "Small (<50K)",
total_popE < 200000 ~ "Medium (50K-200K)",
TRUE ~ "Large (200K+)"
)
)
# MOE by population size
ggplot(county_reliability) +
aes(x = total_popE, y = income_moe_pct) +
geom_point(alpha = 0.7) +
geom_hline(yintercept = 10, color = "red", linetype = "dashed") +
labs(
title = "Data Reliability Decreases with Population Size",
x = "Total Population",
y = "Margin of Error (%)",
caption = "Red line = 10% reliability threshold"
) +
theme_minimal() +
scale_x_continuous(labels = comma)
# Box plots by population category
ggplot(county_reliability) +
aes(x = pop_category, y = income_moe_pct, fill = pop_category) +
geom_boxplot() +
labs(
title = "Data Reliability by County Size Category",
x = "Population Category",
y = "Margin of Error (%)"
) +
theme_minimal() +
theme(legend.position = "none")  # Remove legend since x-axis is clear
county_data <- county_data %>%
mutate(median_ageM_pct = (median_ageM/median_ageE)*100)
ggplot(data = county_data) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(fill = "purple3", size = 2) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
View(county_reliability)
county_reliability <- county_reliabilit %>%
mutate(median_ageM_pct = (median_ageM/median_ageE)*100)
county_reliability <- county_reliability %>%
mutate(median_ageM_pct = (median_ageM/median_ageE)*100)
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(fill = "purple3", size = 2) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
# Box plots by population category
ggplot(county_reliability) +
aes(x = pop_category, y = median_ageM_pct, fill = pop_category) +
geom_boxplot() +
labs(
title = "Data Reliability by County Size Category",
x = "Population Category",
y = "Margin of Error (%)"
) +
theme_minimal() +
theme(legend.position = "none")
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(fill = "purple", size = 2) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(fill = "purple", size = 2, alpha = 0.7) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(color = "purple", size = 2, alpha = 0.7) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(color = "purple4", size = 2, alpha = 0.7) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
ggplot(data = county_reliability) +
aes(x = total_popE, y = median_ageM_pct) +
geom_point(color = "purple3", size = 2, alpha = 0.7) +
geom_hline(yintercept = 5, colour = "lightblue3", linetype = "dashed") +
theme_classic()
